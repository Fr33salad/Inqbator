<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
    
    <title>🧠 GPT Prompt Builder</title>
    <style>
      body{font-family:sans-serif;margin:2em;max-width:800px}button,textarea{margin:.5em 0;padding:.5em}textarea{width:100%;height:100px}.stripe-donate{background:#6772e5;color:#fff;border:none;cursor:pointer;padding:.6em 1.2em}#response{white-space:pre-wrap;background:#f9f9f9;padding:1em;border:1px solid #ccc;min-height:80px}iframe{width:100%;height:400px;border:2px dashed #aaa;margin-top:1em}</style></head><body><h1>💬 Prompt Builder</h1><p>This iframe-ready SPA lets you run GPT prompts, donate via Stripe, and download session exports.</p><button class="stripe-donate">Donate via Stripe</button><textarea id="prompt" placeholder="Enter your GPT prompt here..."></textarea><button onclick="callOpenAI()">▶️ Run GPT</button><div id="response"></div><button onclick="exportData()">📤 Download .md + .json</button><button class="stripe-donate">Donate Again</button><h3>🪟 Embedded Prompt Runner (iframe)</h3><iframe src="" id="mirrorFrame" sandbox="allow-scripts allow-same-origin"></iframe><script>const getOpenAIKey=()=>{let k=localStorage.getItem('openai_key');if(!k){k=prompt('Enter your OpenAI API key:');if(k)localStorage.setItem('openai_key',k)}return k};const setupStripe=()=>{document.querySelectorAll('.stripe-donate').forEach(b=>{b.onclick=()=>window.open('https://buy.stripe.com/test_00g4kW4tb6W9fhGbII','_blank')})};const download=(d,f,t)=>{const b=new Blob([d],{type:t}),a=document.createElement('a');a.href=URL.createObjectURL(b);a.download=f;a.click()};const exportData=()=>{const p=document.getElementById('prompt').value,r=document.getElementById('response').textContent,t=new Date().toISOString(),j=JSON.stringify({prompt:p,response:r,timestamp:t},null,2),m=`---\nprompt: \"${p.replace(/"/g,'\\\"')}\"\ndate: ${t}\n---\n\n${r}`;download(j,'gpt_output.json','application/json');download(m,'gpt_output.md','text/markdown')};const callOpenAI=async()=>{const k=getOpenAIKey(),p=document.getElementById('prompt').value;if(!k||!p){alert('Missing API key or prompt');return}try{const r=await fetch('https://api.openai.com/v1/completions',{method:'POST',headers:{'Content-Type':'application/json','Authorization':`Bearer ${k}`},body:JSON.stringify({model:'text-davinci-003',prompt:p,max_tokens:150})}),d=await r.json(),x=d.choices?.[0]?.text?.trim()||'No response.';document.getElementById('response').textContent=x;window.parent!==window&&window.parent.postMessage({prompt:p,response:x},'*')}catch(e){alert('Error: '+e.message),console.error(e)}};setInterval(()=>{window.parent!==window&&window.parent.postMessage({height:document.body.scrollHeight},'*')},500);window.onload=()=>{setupStripe();document.getElementById('mirrorFrame').src=window.location.href};</script></body>
</html>
